# Feature: Haryanvi Music Analytics Platform

## Context
Building a music analytics platform for Haryanvi music industry using Spotify data. MVP displays top 10 artists and songs by popularity. Data already populated in D1 database, initially no Spotify API integration (added later).

## Phases

### ✅ Phase 1: Schema Integration (COMPLETE)
- [x] Move `haryanvibe-schema.ts` to `packages/data-ops/src/drizzle/`
- [x] Export schema tables from data-ops package.json paths
- [x] Rebuild data-ops package (`pnpm run build:data-ops`)
- [x] Verify exports work in user-application

### ✅ Phase 2: Query Layer (COMPLETE)
- [x] Create query functions for top artists/songs
- [x] Define query parameters & return types (offset pagination)
- [x] Export from data-ops package
- [x] Document pagination decision in CLAUDE.md

### ✅ Phase 3A: Server Functions (COMPLETE)
- [x] Create API routes for /api/artists and /api/songs
- [x] Implement server functions using query layer
- [x] Handle query params (page, limit, sortBy, order)
- [x] Return JSON responses with pagination metadata
- [x] Test with .rest client
- [x] Fix OAuth for local dev (baseURL + trustedOrigins)
- [x] Add watch mode scripts for faster iteration

### ✅ Phase 3B: Cleanup & Setup (COMPLETE)
- [x] Remove starter kit landing page components (HeroSection, FeaturesSection, etc)
- [x] Delete unused component directories (`src/components/landing/`, `src/components/demo/`)
- [x] Keep minimal NavigationBar and Footer
- [x] Install Shadcn components: `pnpx shadcn@latest add card avatar skeleton badge`
- [x] Verify existing API routes work (`/api/artists`, `/api/songs`)

### ✅ Phase 3C: Chart Components & Homepage (COMPLETE)
- [x] Create `src/components/charts/chart-card.tsx` - Chart preview card with hover effect
- [x] Create `src/components/charts/artist-preview-item.tsx` - Mini artist card
- [x] Create `src/components/charts/song-preview-item.tsx` - Mini song card
- [x] Rewrite `src/routes/index.tsx` - New homepage layout
- [x] Add "Top Artists" section with 2 charts (Most Popular, Most Followed)
- [x] Add "Top Songs" section with 2 charts (Most Popular, Latest Releases)
- [x] Implement responsive grid (3 cols desktop, 1 col mobile, vertical stack)
- [x] Setup TanStack Query hooks for client-side data fetching
- _Hover effect: scale-[1.02] + shadow-lg + border-primary/50, duration-200_
- _Mobile: Vertical stack, no horizontal scroll_

### ✅ Phase 3D: Detail Pages & Polish (COMPLETE)
- [x] Create breadcrumb component
- [x] Create `src/routes/charts/artists/popular.tsx` - Top 20 popular artists
- [x] Create `src/routes/charts/artists/followers.tsx` - Top 20 followed artists
- [x] Create `src/routes/charts/songs/popular.tsx` - Top 20 popular songs
- [x] Create `src/routes/charts/songs/latest.tsx` - Top 20 latest releases
- [x] Implement client-side data fetching with TanStack Query
- [x] Add loading skeletons for all detail pages
- [x] Verify production build passes
- _Breadcrumbs: Home → Artists/Songs → Chart Name_
- _Data fetching: Client-side via `/api/artists` and `/api/songs` (same as homepage)_
- _Note: Routes auto-generated by TanStack Router on dev server start_

### ✅ Phase 4: Artist Detail Page (COMPLETE)
- [x] Add query functions to `packages/data-ops/src/queries/haryanvibe.ts`
  - `getArtistById(artistId, db)` - fetch artist, return null if not found
  - `getArtistSongsByType(artistId, type, page, limit, db)` - paginated songs (popular or recent)
- [x] Create `/api/artist.$artistId.tsx` - GET /api/artist/:artistId
  - Returns artist + top 20 popular + 10 recent
  - 404 if artist not found
- [x] Create `/api/artist.$artistId.songs.tsx` - GET /api/artist/:artistId/songs?type=popular|recent&page=1&limit=20
  - Returns paginated songs by type
  - 404 if artist not found
  - 400 for invalid type parameter
- [x] Test with .rest client
- _Main endpoint: artist + popularSongs (20) + recentSongs (10) + hasMore flags_
- _Pagination endpoint: type param (popular|recent) with offset pagination_
- _Query: Join via songArtists, ORDER BY popularity DESC or releaseDate DESC_

## Current State
- ✅ Schema integrated into data-ops: `packages/data-ops/src/drizzle/haryanvibe-schema.ts`
- ✅ Schema exports available: `@repo/data-ops/drizzle/haryanvibe-schema`
- ✅ Query functions created: `packages/data-ops/src/queries/haryanvibe.ts`
- ✅ Offset pagination with sort options (popularity, followers, releaseDate)
- ✅ Pagination decision documented in CLAUDE.md
- ✅ API routes: `/api/artists` and `/api/songs` working with remote D1
- ✅ OAuth fixed for local dev (baseURL + trustedOrigins in Better Auth)
- ✅ Watch mode scripts added for faster dev iteration
- ✅ Dev workflow: wrangler dev --remote (connects to production D1)
- D1 database tables already created and populated with data
- Tables: `haryanvibe_artists`, `haryanvibe_songs`, `song_artists`
- All artists/songs have required images
- No Spotify API integration yet (future phase)

## Next Steps
1. ✅ ~~Implement Phase 1 (Schema Integration)~~ - COMPLETE
2. ✅ ~~Brainstorm Phase 2 (Query Layer)~~ - COMPLETE
3. ✅ ~~Implement Phase 3A (Server Functions)~~ - COMPLETE
4. ✅ ~~Brainstorm Phase 3B (Homepage UI)~~ - COMPLETE
5. ✅ ~~Implement Phase 3B (Cleanup & Setup)~~ - COMPLETE
6. ✅ ~~Implement Phase 3C (Chart Components & Homepage)~~ - COMPLETE
7. ✅ ~~Implement Phase 3D (Detail Pages & Polish)~~ - COMPLETE
8. ✅ ~~Implement Phase 4 (Artist Detail Page)~~ - COMPLETE

## Blockers
None

## Key Files
- `packages/data-ops/src/drizzle/haryanvibe-schema.ts` - Haryanvi schema
- `packages/data-ops/src/queries/haryanvibe.ts` - Query functions (getArtists, getSongs, getArtistById, getArtistSongsByType)
- `packages/data-ops/src/auth/setup.ts` - Better Auth config (baseURL, trustedOrigins)
- `apps/user-application/src/routes/api/artists.tsx` - Artists API route
- `apps/user-application/src/routes/api/songs.tsx` - Songs API route
- `apps/user-application/src/routes/api/artist.$artistId.tsx` - Artist detail API route
- `apps/user-application/src/routes/api/artist.$artistId.songs.tsx` - Artist songs pagination API route
- `apps/user-application/src/server.ts` - Custom server entry (DB + Auth init)
- `apps/user-application/src/routes/index.tsx` - Homepage (Phase 3B)
- `test/rest/haryanvi-analytics.rest` - API test requests
- `CLAUDE.md` - Pagination decision documented

## Delete After
Feature is merged and tested
